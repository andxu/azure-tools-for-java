Feature: Cosmos Serverless Spark Batch Job Testing

  Scenario: submit spark job test
    Given setup a mock cosmos serverless service for 'PUT' detail request '/activityTypes/spark/batchJobs/46c07889-3590-48f8-b2bc-7f52622b5a0b?api-version=2018-02-01-preview' with body '{"name":"ServerlessSession_46c07889-3590-48f8-b2bc-7f52622b5a0b","priority":1000,"properties":{"className":"sample.JavaSparkPi","file":"adl://test.dogfood.net/rufan/serverless/artifact/serverless_artifact.jar","sparkEventsDirectoryPath":"adl://test.dogfood.net/spark-events","name":"Session_46c07889-3590-48f8-b2bc-7f52622b5a0b","driverMemory":"12G","driverCores":4,"executorCores":4,"numExecutors":2,"executorMemory":"12G"}}' to return '{"properties":{"responsePayload":{"id":0,"appInfo":{"driverLogUrl":null,"sparkUiUrl":null},"log":[],"state":"started"},"sparkMasterUI":"https://46c07889-3590-48f8-b2bc-7f52622b5a0b.azuredatalakeanalytics.net"},"id":"46c07889-3590-48f8-b2bc-7f52622b5a0b","priority":1000,"name":"Session_46c07889-3590-48f8-b2bc-7f52622b5a0b","activityType":"spark","submitter":"rufan","analyticsUnits":9,"submitTime":"2018-11-12T23:57:38.327Z","startTime":"2018-11-12T23:57:38.827Z","endTime":"2018-11-13T00:03:20.183Z","state":"Ended"}' with status code 200
    And setup a mock cosmos serverless service for 'GET' request '/activityTypes/spark/batchJobs/46c07889-3590-48f8-b2bc-7f52622b5a0b?api-version=2018-02-01-preview' to return '{"properties":{"responsePayload":{"id":10,"appInfo":{"driverLogUrl":null,"sparkUiUrl":null},"log":[],"state":"started"},"sparkMasterUI":"https://46c07889-3590-48f8-b2bc-7f52622b5a0b.azuredatalakeanalytics.net"},"id":"46c07889-3590-48f8-b2bc-7f52622b5a0b","priority":1000,"name":"Session_46c07889-3590-48f8-b2bc-7f52622b5a0b","activityType":"spark","submitter":"rufan","analyticsUnits":9,"submitTime":"2018-11-12T23:57:38.327Z","startTime":"2018-11-12T23:57:38.827Z","endTime":"2018-11-13T00:03:20.183Z","state":"Ended"}' with status code 200
    And submit a cosmos serverless spark batch job
    Then verify 'PUT' request for '/activityTypes/spark/batchJobs/46c07889-3590-48f8-b2bc-7f52622b5a0b?api-version=2018-02-01-preview'
    Then batch ID should be 10
